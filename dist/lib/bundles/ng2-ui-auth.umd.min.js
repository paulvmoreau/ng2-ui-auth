!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng2-ui-auth",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ng2-ui-auth"]={},t.ng.core,t.ng.common.http,t.rxjs,t.rxjs.operators)}(this,(function(t,e,o,r,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)};Object.create;function a(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var r,i,n=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=n.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}return a}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}Object.create;function p(t,e){return/^(?:[a-z]+:)?\/\//i.test(e)?e:[t,e].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function u(t){return Object.keys(t).map((function(e){return t[e]?encodeURIComponent(e)+"="+encodeURIComponent(t[e]):e})).join("&")}function c(t){t||"undefined"==typeof window||(t=window);try{return t&&t.location?t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:""):null}catch(t){return null}}var h,l={facebook:{name:"facebook",url:"/auth/facebook",redirectUri:c()+"/",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",additionalUrlParams:{display:"popup"},scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",additionalUrlParams:{display:"popup",prompt:void 0,login_hint:void 0,access_type:void 0,include_granted_scopes:void 0,"openid.realm":void 0,hd:void 0},scope:["openid","email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:452,height:633},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",scope:["r_emailaddress"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:527,height:582},state:"STATE"},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",scope:["user_read"],scopeDelimiter:" ",additionalUrlParams:{display:"popup"},oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",additionalUrlParams:{display:"popup"},scope:["wl.emails"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:c()+"/",scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:1028,height:529}},spotify:{name:"spotify",url:"/auth/spotify",authorizationEndpoint:"https://accounts.spotify.com/authorize",scope:["","user-read-email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:500,height:530},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}}};(h=t.StorageType||(t.StorageType={})).NONE="none",h.MEMORY="memory",h.LOCAL_STORAGE="localStorage",h.SESSION_STORAGE="sessionStorage",h.COOKIE="cookie",h.SESSION_COOKIE="sessionCookie";var d=new e.InjectionToken("config.options"),f=function(){function e(e){this.options={withCredentials:!1,tokenRoot:null,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenSeparator:"_",tokenPrefix:"ng2-ui-auth",authHeader:"Authorization",authToken:"Bearer",storageType:t.StorageType.LOCAL_STORAGE,cordova:void 0,resolveToken:function(t,e){var o=t&&(t.access_token||t.token||t.data);if(!o)return null;if("string"==typeof o)return o;if("object"!=typeof o)return null;var r=e.tokenRoot&&e.tokenRoot.split(".").reduce((function(t,e){return t[e]}),o),i=r?r[e.tokenName]:o[e.tokenName];return i||null},providers:{}},this.options=Object.assign(Object.assign({},this.options),e),this.mergeWithDefaultProviders()}return e.prototype.updateProviders=function(t){this.options.providers=Object.assign(Object.assign({},this.options.providers||{}),t),this.mergeWithDefaultProviders()},e.prototype.mergeWithDefaultProviders=function(){var t=this;Object.keys(this.options.providers).forEach((function(e){e in l&&(t.options.providers[e]=Object.assign(Object.assign({},l[e]),t.options.providers[e]))}))},e}();f.decorators=[{type:e.Injectable}],f.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[d]}]}]};var g=function(){},y=function(e){function o(o){var r=e.call(this)||this;return r.config=o,r.store={},r.storageType=t.StorageType.MEMORY,r.updateStorageType(o.options.storageType)||console.warn(o.options.storageType+" is not available."),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(o,e),o.prototype.updateStorageType=function(t){return!!this.checkIsStorageAvailable(t)&&(this.storageType=t,!0)},o.prototype.get=function(e){switch(this.storageType){case t.StorageType.COOKIE:case t.StorageType.SESSION_COOKIE:return this.getCookie(e);case t.StorageType.LOCAL_STORAGE:case t.StorageType.SESSION_STORAGE:return window[this.storageType].getItem(e);case t.StorageType.MEMORY:return this.store[e];case t.StorageType.NONE:default:return null}},o.prototype.set=function(e,o,r){switch(this.storageType){case t.StorageType.COOKIE:case t.StorageType.SESSION_COOKIE:this.setCookie(e,o,this.storageType===t.StorageType.COOKIE?r:"");break;case t.StorageType.LOCAL_STORAGE:case t.StorageType.SESSION_STORAGE:window[this.storageType].setItem(e,o);break;case t.StorageType.MEMORY:this.store[e]=o;break;case t.StorageType.NONE:}},o.prototype.remove=function(e){switch(this.storageType){case t.StorageType.COOKIE:case t.StorageType.SESSION_COOKIE:this.removeCookie(e);break;case t.StorageType.LOCAL_STORAGE:case t.StorageType.SESSION_STORAGE:window[this.storageType].removeItem(e);break;case t.StorageType.MEMORY:delete this.store[e];break;case t.StorageType.NONE:}},o.prototype.checkIsStorageAvailable=function(e){switch(e){case t.StorageType.COOKIE:case t.StorageType.SESSION_COOKIE:return this.isCookieStorageAvailable();case t.StorageType.LOCAL_STORAGE:case t.StorageType.SESSION_STORAGE:return this.isWindowStorageAvailable(e);case t.StorageType.NONE:case t.StorageType.MEMORY:return!0;default:return!1}},o.prototype.isWindowStorageAvailable=function(t){try{var e=window&&t in window&&null!==window[t];if(e){var o=Math.random().toString(36).substring(7);window[t].setItem(o,""),window[t].removeItem(o)}return e}catch(t){return!1}},o.prototype.isCookieStorageAvailable=function(){try{if(document&&"cookie"in document){var t=Math.random().toString(36).substring(7);this.setCookie(t,"test",new Date(Date.now()+6e4).toUTCString());var e=this.getCookie(t);return this.removeCookie(t),"test"===e}return!1}catch(t){return!1}},o.prototype.setCookie=function(t,e,o,r){void 0===o&&(o=""),void 0===r&&(r="/"),document.cookie=t+"="+e+(o?"; expires="+o:"")+"; path="+r},o.prototype.removeCookie=function(t,e){void 0===e&&(e="/"),this.setCookie(t,"",new Date(0).toUTCString(),e)},o.prototype.getCookie=function(t){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},o}(g);y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:f}]};var v=function(){function t(t,e){this.storage=t,this.config=e,this.tokenName=this.config.options.tokenPrefix?[this.config.options.tokenPrefix,this.config.options.tokenName].join(this.config.options.tokenSeparator):this.config.options.tokenName}return t.prototype.getToken=function(){return this.storage.get(this.tokenName)},t.prototype.getPayload=function(t){if(void 0===t&&(t=this.getToken()),t&&3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(this.b64DecodeUnicode(e))}catch(t){return}},t.prototype.setToken=function(t){var e;if(t&&(e="string"==typeof t?t:this.config.options.resolveToken(t,this.config.options))){var o=this.getExpirationDate(e);this.storage.set(this.tokenName,e,o?o.toUTCString():"")}},t.prototype.removeToken=function(){this.storage.remove(this.tokenName)},t.prototype.isAuthenticated=function(t){if(void 0===t&&(t=this.getToken()),t){if(3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(this.b64DecodeUnicode(e)).exp;if(o)return!(Math.round((new Date).getTime()/1e3)>=o)||(this.storage.remove(this.tokenName),!1)}catch(t){return!0}return!0}return!1},t.prototype.getExpirationDate=function(t){void 0===t&&(t=this.getToken());var e=this.getPayload(t);if(e&&e.exp&&Math.round((new Date).getTime()/1e3)<e.exp){var o=new Date(0);return o.setUTCSeconds(e.exp),o}return null},t.prototype.logout=function(){var t=this;return r.Observable.create((function(e){t.storage.remove(t.tokenName),e.next(),e.complete()}))},t.prototype.setStorageType=function(t){return this.storage.updateStorageType(t)},t.prototype.b64DecodeUnicode=function(t){return decodeURIComponent(Array.prototype.map.call(atob(t),(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))},t}();v.decorators=[{type:e.Injectable}],v.ctorParameters=function(){return[{type:g},{type:f}]};var m=function(){function t(t,e){this.shared=t,this.config=e}return t.prototype.intercept=function(t,e){var o,r=this.config.options,i=r.authHeader,n=r.authToken,a=this.shared.getToken(),s=this.shared.isAuthenticated()&&!t.headers.has(i)?t.clone({setHeaders:(o={},o[i]=n+" "+a,o)}):t;return e.handle(s)},t}();m.decorators=[{type:e.Injectable}],m.ctorParameters=function(){return[{type:v},{type:f}]};var S=function(){function t(){}return t.prototype.open=function(t,e,o){void 0===o&&(o=this.isCordovaApp());var i=this.stringifyOptions(this.prepareOptions(e.popupOptions)),n=o?"_blank":e.name,a="undefined"!=typeof window?window.open(t,n,i):null;return a?(a.focus&&a.focus(),r.of(a)):r.empty()},t.prototype.waitForClose=function(t,e,o){return void 0===e&&(e=this.isCordovaApp()),void 0===o&&(o=c()),e?this.eventListener(t,o):this.pollPopup(t,o)},t.prototype.eventListener=function(t,e){var o=this;if(void 0===e&&(e=c()),!t)throw new Error("Popup was not created");return r.merge(r.fromEvent(t,"exit").pipe(i.delay(100),i.map((function(){throw new Error("Authentication Canceled")}))),r.fromEvent(t,"loadstart")).pipe(i.switchMap((function(i){if(!t||t.closed)return r.Observable.throw(new Error("Authentication Canceled"));if(0!==i.url.indexOf(e))return r.empty();var n=document.createElement("a");if(n.href=i.url,n.search||n.hash){var a=n.search.substring(1).replace(/\/$/,""),s=n.hash.substring(1).replace(/\/$/,""),p=o.parseQueryString(s),u=o.parseQueryString(a),c=Object.assign(Object.assign({},u),p);if(t.close(),c.error)throw c.error;return r.of(c)}return r.empty()})),i.take(1))},t.prototype.pollPopup=function(t,e){var o=this;return void 0===e&&(e=c()),r.interval(50).pipe(i.switchMap((function(){if(!t||t.closed)return r.throwError(new Error("Authentication Canceled"));var i=c(t);if(i&&(0===e.indexOf(i)||0===i.indexOf(e))&&(t.location.search||t.location.hash)){var n=t.location.search.substring(1).replace(/\/$/,""),a=t.location.hash.substring(1).replace(/[\/$]/,""),s=o.parseQueryString(a),p=o.parseQueryString(n);t.close();var u=Object.assign(Object.assign({},p),s);if(u.error)throw u.error;return r.of(u)}return r.empty()})),i.take(1))},t.prototype.prepareOptions=function(t){var e=(t=t||{}).width||500,o=t.height||500;return Object.assign({width:e,height:o,left:window.screenX+(window.outerWidth-e)/2,top:window.screenY+(window.outerHeight-o)/2.5,toolbar:t.visibleToolbar?"yes":"no"},t)},t.prototype.stringifyOptions=function(t){return Object.keys(t).map((function(e){return null===t[e]||void 0===t[e]?e:e+"="+t[e]})).join(",")},t.prototype.parseQueryString=function(t){var e;return t.split("&").reduce((function(t,o){return o&&(e=o.split("="),t[decodeURIComponent(e[0])]=void 0===e[1]||decodeURIComponent(e[1])),t}),{})},t.prototype.isCordovaApp=function(){return"object"==typeof cordova||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")},t}();S.decorators=[{type:e.Injectable}];var O=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(t,e){var o=this,r=this.config.options.baseUrl?p(this.config.options.baseUrl,t.url):t.url;return this.popup.open("about:blank",t,this.config.options.cordova).pipe(i.switchMap((function(e){return o.http.post(r,t).pipe(i.tap((function(o){return e?e.location.replace([t.authorizationEndpoint,u(o)].join("?")):void 0})),i.switchMap((function(r){return o.popup.waitForClose(e,o.config.options.cordova,t.redirectUri).pipe(i.map((function(t){return{authorizationData:r,oauthData:t}})))})))})),i.switchMap((function(r){var i=r.authorizationData,n=r.oauthData;return o.exchangeForToken(t,i,n,e)})))},t.prototype.exchangeForToken=function(t,e,o,r){var i={oauthOptions:t,authorizationData:e,oauthData:o,userData:r},n=this.config.options,a=n.withCredentials,s=n.baseUrl,u=t.method,c=void 0===u?"POST":u,h=t.url,l=s?p(s,h):h;return this.http.request(c,l,{body:i,withCredentials:a})},t}();O.decorators=[{type:e.Injectable}],O.ctorParameters=function(){return[{type:o.HttpClient},{type:S},{type:f}]};var T=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(t,e){var o=this,n=this.getAuthorizationData(t),a=[t.authorizationEndpoint,u(n)].join("?");return this.popup.open(a,t,this.config.options.cordova).pipe(i.switchMap((function(e){return e?o.popup.waitForClose(e,o.config.options.cordova,t.redirectUri):r.empty()})),i.switchMap((function(i){if("token"===t.responseType||!t.url)return r.of(i);if(i.state&&i.state!==n.state)throw new Error('OAuth "state" mismatch');return o.exchangeForToken(t,n,i,e)})))},t.prototype.exchangeForToken=function(t,e,o,r){var i={authorizationData:e,oauthData:o,userData:r},n=this.config.options,a=n.baseUrl,s=n.withCredentials,u=t.url,c=t.method,h=void 0===c?"POST":c,l=a?p(a,u):u;return this.http.request(h,l,{body:i,withCredentials:s})},t.prototype.getAuthorizationData=function(t){var e=t.responseType,o=void 0===e?"code":e,r=t.clientId,i=t.redirectUri,n=void 0===i?c()||"":i,a=t.scopeDelimiter,p=void 0===a?",":a,u=t.scope,h=t.state,l=t.additionalUrlParams,d="function"==typeof h?h():h;return s([["response_type",o],["client_id",r],["redirect_uri",n]],h?[["state",d]]:[],u?[["scope",u.join(p)]]:[],l?Object.keys(l).map((function(t){var e=l[t];return"string"==typeof e?[t,e]:"function"==typeof e?[t,e()]:null===e?[t,""]:["",""]})):[]).filter((function(t){return!!t[0]})).reduce((function(t,e){var o;return Object.assign(Object.assign({},t),((o={})[e[0]]=e[1],o))}),{})},t}();T.decorators=[{type:e.Injectable}],T.ctorParameters=function(){return[{type:o.HttpClient},{type:S},{type:f}]};var w=function(){function t(t,e,r,i){this.http=t,this.shared=e,this.config=r,this.popup=i,this.depProviders=[{provide:o.HttpClient,useValue:this.http},{provide:S,useValue:this.popup},{provide:f,useValue:this.config}],this.deps=[o.HttpClient,S,f]}return t.prototype.authenticate=function(t,o){var r=this;return("1.0"===this.config.options.providers[t].oauthType?e.Injector.create(s(this.depProviders,[{provide:O,deps:this.deps}])).get(O):e.Injector.create(s(this.depProviders,[{provide:T,deps:this.deps}])).get(T)).open(this.config.options.providers[t],o||{}).pipe(i.tap((function(e){r.config.options.providers[t].url&&r.shared.setToken(e)})))},t.prototype.unlink=function(t,e,o){return void 0===e&&(e=p(this.config.options.baseUrl,this.config.options.unlinkUrl)),void 0===o&&(o="POST"),this.http.request(o,e,{body:{provider:t}})},t}();w.decorators=[{type:e.Injectable}],w.ctorParameters=function(){return[{type:o.HttpClient},{type:v},{type:f},{type:S}]};var b=function(){function t(t,e,o){this.http=t,this.shared=e,this.config=o}return t.prototype.login=function(t,e){var o=this;return this.http.post(e||p(this.config.options.baseUrl,this.config.options.loginUrl),t).pipe(i.tap((function(t){return o.shared.setToken(t)})))},t.prototype.signup=function(t,e){return this.http.post(e||p(this.config.options.baseUrl,this.config.options.signupUrl),t)},t}();b.decorators=[{type:e.Injectable}],b.ctorParameters=function(){return[{type:o.HttpClient},{type:v},{type:f}]};var k=function(){function t(t,e,o){this.shared=t,this.local=e,this.oauth=o}return t.prototype.login=function(t,e){return this.local.login(t,e)},t.prototype.signup=function(t,e){return this.local.signup(t,e)},t.prototype.logout=function(){return this.shared.logout()},t.prototype.authenticate=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.link=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.unlink=function(t,e){return this.oauth.unlink(t,e)},t.prototype.isAuthenticated=function(){return this.shared.isAuthenticated()},t.prototype.getToken=function(){return this.shared.getToken()},t.prototype.setToken=function(t){this.shared.setToken(t)},t.prototype.removeToken=function(){this.shared.removeToken()},t.prototype.getPayload=function(){return this.shared.getPayload()},t.prototype.setStorageType=function(t){return this.shared.setStorageType(t)},t.prototype.getExpirationDate=function(){return this.shared.getExpirationDate()},t}();k.decorators=[{type:e.Injectable}],k.ctorParameters=function(){return[{type:v},{type:b},{type:w}]};var C=function(){function t(){}return t.forRoot=function(e,r){return void 0===r&&(r=!0),{ngModule:t,providers:s(e?[{provide:d,useValue:e}]:[],[{provide:f,useClass:f,deps:[d]},{provide:g,useClass:y,deps:[f]},{provide:v,useClass:v,deps:[g,f]},{provide:b,useClass:b,deps:[o.HttpClient,v,f]},{provide:S,useClass:S,deps:[f]},{provide:w,useClass:w,deps:[o.HttpClient,v,f,S]},{provide:k,useClass:k,deps:[v,b,w]}],r?[{provide:o.HTTP_INTERCEPTORS,useClass:m,multi:!0,deps:[v,f]}]:[])}},t}();C.decorators=[{type:e.NgModule,args:[{imports:[o.HttpClientModule],declarations:[],exports:[]}]}],t.AuthService=k,t.BrowserStorageService=y,t.CONFIG_OPTIONS=d,t.ConfigService=f,t.JwtInterceptor=m,t.LocalService=b,t.Ng2UiAuthModule=C,t.Oauth1Service=O,t.Oauth2Service=T,t.OauthService=w,t.PopupService=S,t.SharedService=v,t.StorageService=g,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng2-ui-auth.umd.min.js.map